{__NOLAYOUT__}
{include file='public/header' /}
<link rel="stylesheet" type="text/css" href="http://www.treejs.cn/v3/css/zTreeStyle/zTreeStyle.css">
<div class="container-fluid bg-white">
    <br>
    <div class="row">
        <div class="m-auto">
            <div class="zTreeDemoBackground left">
                <ul id="treeDemo" class="ztree"></ul>
            </div>
        </div>
        <form class="m-auto w-75" id="content" style="display: none;">
            <button class="sub-bindbtn" lay-submit lay-filter="bind" onclick="onCheck()" style="display: none;">
            </button>
        </form>
        <!-- <a href="javascript:;" onclick="onCheck()">213123123</a> -->
    </div>
</div>
{include file='public/script' /}
<script type="text/javascript" src="http://www.treejs.cn/v3/js/jquery.ztree.core.js"></script>
<script type="text/javascript" src="http://www.treejs.cn/v3/js/jquery.ztree.excheck.js"></script>
<script type="text/javascript">
function getData() {

    var getData;

    $.ajax({
        type: "post",
        url: "{$Request.root}/{$Request.controller}/roleUserAuth",
        async: false,
        data: {
            "role_id": {$id}
        },

        success: function(result) {
            getData = result.data
        },
        error: function() {
            alert("获取服务器失败");
        }
    });

    return getData;
}



var setting = {
    check: {
        enable: true
    },
    data: {
        simpleData: {
            enable: true
        }
    }
};

var zNodes = getData();


var code;

function setCheck() {
    setting.check.chkboxType = { "Y": "ps", "N": "ps" };
    // var zTree = $.fn.zTree.getZTreeObj("treeDemo"),
    //     py = $("#py").attr("checked") ? "p" : "",
    //     sy = $("#sy").attr("checked") ? "s" : "",
    //     pn = $("#pn").attr("checked") ? "p" : "",
    //     sn = $("#sn").attr("checked") ? "s" : "",
    //     type = { "Y": py + sy, "N": pn + sn };
    // zTree.setting.check.chkboxType = type;
    // showCode('setting.check.chkboxType = { "Y" : "' + type.Y + '", "N" : "' + type.N + '" };');
}

function showCode(str) {
    if (!code) code = $("#code");
    code.empty();
    code.append("<li>" + str + "</li>");
}

$(document).ready(function() {
    $.fn.zTree.init($("#treeDemo"), setting, zNodes);
    setCheck();
    $("#py").bind("change", setCheck);
    $("#sy").bind("change", setCheck);
    $("#pn").bind("change", setCheck);
    $("#sn").bind("change", setCheck);



});


function onCheck(e, treeId, treeNode) {

    var treeObj = $.fn.zTree.getZTreeObj("treeDemo"),
        nodes = treeObj.getCheckedNodes(true),
        v = "";
    var arr = new Array()
    for (var i = 0; i < nodes.length; i++) {
        v += nodes[i].name + ",";
        arr.push(nodes[i].id)
        // alert(nodes[i].id); //获取选中节点的值
    }
    console.log(arr)
    $.post("{:url('adminrole/roleUserAuthPost')}", {authStr:arr,id:{$id}}, function (data) {
        if (data.code == 1) {
            reloadPage(window);
        }

    }, "json");


}



// var zNodes = [
//     { id: 1, pId: 0, name: "菜单", open: true },
//     { id: 11, pId: 1, name: "随意勾选 1-1", open: true },
//     { id: 111, pId: 11, name: "随意勾选 1-1-1" },
//     { id: 112, pId: 11, name: "随意勾选 1-1-2" },
//     { id: 12, pId: 1, name: "随意勾选 1-2", open: true },
//     { id: 121, pId: 12, name: "随意勾选 1-2-1" },
//     { id: 122, pId: 12, name: "随意勾选 1-2-2" },
//     { id: 2, pId: 0, name: "随意勾选 2", checked: true, open: true },
//     { id: 21, pId: 2, name: "随意勾选 2-1" },
//     { id: 22, pId: 2, name: "随意勾选 2-2", open: true },
//     { id: 221, pId: 22, name: "随意勾选 2-2-1", checked: true },
//     { id: 222, pId: 22, name: "随意勾选 2-2-2" },
//     { id: 23, pId: 2, name: "随意勾选 2-3" }
// ];


</script>