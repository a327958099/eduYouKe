{__NOLAYOUT__}
<html>

<head>
    <title>管理后台登录 {$site_info.site_name|default=''}</title>
    <meta name="keywords" content="{$site_info.site_seo_keywords|default=''}" />
    <meta name="description" content="{$site_info.site_seo_description|default=''}">
    {include file='../public/header' /}
    <!-- {load href="/static/admin/detault/css/login.css" /} -->
    <style type="text/css">
    body {
        background-image: url("/static/img/adminbg.png");
        background-attachment: fixed;
        background-size: cover;
        background-repeat: no-repeat;
    }

    .login {
        top: 150px;
    }
    </style>
</head>

<body>
    <div class="container container-body">
        <div class="row justify-content-center">
            <div class="col-lg-6 col-md-6 mt-4 login card">
                <div class="login media bg-white" id="login">
                    <div class="align-self-center mx-auto">
                        <div class="text-with-hr mt-4">
                            <span style="font-weight: 600;">后台登录</span>
                        </div>
                        <form class="m-auto" id="content" action="{$Request.root}/{$Request.controller}/doLogin">
                            <div id="nickname-login">
                                <div class="form-group">
                                    <label><strong class="text-black-50">用户名</strong></label>
                                    <input type="text" name="username" class="form-control username">
                                    <!-- <small id="emailHelp" class="form-text text-muted">We'll neasdsadasdsaaaaaaaaaaaaaaav.</small> -->
                                </div>
                                <div class="form-group">
                                    <label><strong class="text-black-50">请输入密码</strong></label>
                                    <input type="password" name="password" class="form-control password">
                                </div>
                                <div class="form-group">
                                    <strong class="text-black-50 ">请输入验证码</strong>
                                    <div class="input-group mt-2 mb-3">
                                        <input type="text" name="verifycode" class="form-control verifycode" aria-describedby="basic-addon">
                                        <div class="input-group-append" style="height: 35px;">
                                            {:captcha_img()}
                                            <!--  <span class="input-group-text" id="basic-addon">
                                            <a href="javascript:;">
                                            {:captcha_img()}
                                        </a>
                                        </span> -->
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group mt-3">
                                    <input type="checkbox" class="form-check-input" id="exampleCheck1">
                                    <label class="form-check-label text-black-50">保持登陆</label>
                                </div>
                                <button id="formLogin" class="btn btn-primary btn-block">登录</button>
                            </div>
                        </form>
                        <br>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>

</html>
{include file='../public/script' /}
<script src="__STATIC__/js/jquery.validate.min.js"></script>
<script type="text/javascript">
$('#content').validate({
    rules: {
        username: {
            required: true,
        },
        password: {
            required: true,
        },
    },
    messages: {
        username: {
            required: "请输入用户名",
        },
        password: {
            required: "请输入密码",
        },
    },
    // errorElement: 'span',
    errorPlacement: function(error, element) {
        error.addClass('invalid-feedback');
        element.closest('.form-group').append(error);
    },
    // highlight: function(element, errorClass, validClass) {
    //     $(element).addClass('is-invalid');
    // },
    // unhighlight: function(element, errorClass, validClass) {
    //     $(element).removeClass('is-invalid');
    // }
});

$("#formLogin").click(function(event) {

    var content = $("form").attr("id");
    var valid = $("#" + content).valid();
    if (valid) {

        event.preventDefault();
        var href = $("#content").attr("action");
        var username = $('.username').val();
        var password = $('.password').val();
        var verifycode = $('.verifycode').val();


        $.post(href, { username: username, password: password, verifycode: verifycode }, function(json) {
            if (json.code == 1) {

                $.alert({
                    type: 'blue',
                    title: '操作提示',
                    content: json.msg,
                    icon: 'glyphicon glyphicon-info-sign'
                });
                setTimeout(function() {
                    // window.location.reload();
                    window.location.href="/admin" 
                }, 1000);


            } else {
                $.alert({
                    type: 'blue',
                    title: '操作提示',
                    content: json.msg,
                    icon: 'glyphicon glyphicon-info-sign'
                });

            }

        }, "json");


    }

});
</script>