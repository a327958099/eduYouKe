<!DOCTYPE html>
<html>

<head>
    <title>首页 {$site_info.site_name|default=''}</title>
    <meta name="keywords" content="{$site_info.site_seo_keywords|default=''}" />
    <meta name="description" content="{$site_info.site_seo_description|default=''}">
    {include file='../public/header' /}
    <link href="/template/web/{$templateName}/public/static/css/login.css" rel="stylesheet">
</head>

<body class="hold-transition layout-top-nav">
    <div class="wrapper">
        {include file='../public/nav' /}
        <div class="content-wrapper">
            <div class="content">
                <div class="container">
                    <div class="row">
                        <div class="col-lg-6 col-md-6 col-auto mt-4 login">
                            <div class="login-img">
                                <img src="/template/web/{$templateName}/public/static/img/loginLeft.jpg">
                            </div>
                        </div>
                        <div class="col-lg-6 col-md-6 col-auto mt-4 login">
                            <div class="login media bg-white">
                                <div class="align-self-center mx-auto">
                                    <div class="text-with-hr mt-4">
                                        <span style="font-weight: 600;">找回密码</span>
                                    </div>
                                    <form method="post">
                                        <div id="sms-login">
                                            <div class="form-group mb-3">
                                                <label><strong class="text-black-50">请输入手机号码</strong></label>
                                                <input type="text" name="mobile" class="form-control mobile">
                                                <!-- <small id="emailHelp" class="form-text text-muted"></small> -->
                                            </div>
                                            <strong class="text-black-50 ">请输入验证码</strong>
                                            <div class="input-group mt-2 mb-3">
                                                <input type="text" name="smscode" class="form-control" aria-describedby="basic-addon">
                                                <div class="input-group-append">
                                                    <span class="input-group-text" id="basic-addon">
                                                        <a href="javascript:;">获取验证码</a>
                                                    </span>
                                                </div>
                                            </div>
                                            <div class="form-group mb-3">
                                                <label><strong class="text-black-50">请输入密码</strong></label>
                                                <input type="text" name="password" class="form-control mobile">
                                                <!-- <small id="emailHelp" class="form-text text-muted"></small> -->
                                            </div>
                                        </div>
                                        <button id="forgetForm" class="btn btn-primary btn-block">重置密码</button>
                                    </form>
                                    <div class="clearfix"></div>
                                    <div class="forget-password mt-2">
                                        <p>
                                            <label class="form-check-label text-black-50">
                                                <a href="{:url('/login/login')}">
                                                    账号登陆
                                                </a>
                                            </label>
                                            <label class="float-right text-black-50" for="exampleCheck1">
                                                <a href="{:url('/login/register')}">
                                                    账号注册
                                                </a>
                                            </label>
                                        </p>
                                    </div>
                                    <div class="clearfix"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {include file='../public/footer' /}
    </div>
    {include file='../public/script' /}
</body>
<script type="text/javascript">
$(".sms-login").click(function() {
    $("#nickname-login").hide();
    $("#sms-login").show();
    $(".sms-login").hide();
    $(".nickname-login").show();
});

$(".nickname-login").click(function() {
    $("#nickname-login").show();
    $("#sms-login").hide();
    $(".sms-login").show();
    $(".nickname-login").hide();
});




$("#basic-addon").click(function() {
    var mobile;
    mobile = $(".mobile").val();


    //验证手机号
    switch (CheckMobile(mobile)) {
        case 0:
            return error('手机号不能为空')
            break;
        case 2:
            return error('请输入正确的手机号')
            break;
        default:
    }


    var mobile = $('input[name="mobile"]').val();

    //请求短信接口
    $.post("{:url('/login/getSmsCode')}", { type: 1, mobile: mobile}, function(data) {
        if (data.code == 1) {

            //展示文案
            return success('验证码获取成功');
            //todo
        }
    });

    //更改点击状态
    $("#basic-addon").addClass('sms-second');

    //验证码定时器
    timesRun = 30;
    $("#basic-addon").find("a").text("剩余" + timesRun + 's');
    var interval = setInterval(function() {
        timesRun -= 1;
        $("#basic-addon").find("a").text("剩余" + timesRun + 's');
        if (timesRun === 0) {
            $("#basic-addon").find("a").text('重新获取');
            $("#basic-addon").removeClass('sms-second');
            clearInterval(interval);
        }
    }, 1000);



});


$("#forgetForm").click(function(event) {

    event.preventDefault();


    var mobile = $('input[name="mobile"]').val();
    var password = $('input[name="password"]').val();
    var smscode = $('input[name="smscode"]').val();


    $.post("{:url('/login/forget')}", { mobile: mobile, password: password, smscode: smscode }, function(json) {

        if (json.code == 1) {

            success(json.msg);
            setTimeout(function() {
                window.location.href = "/login/login"
            }, 1000);


        } else {

            return error(json.msg);
        }

    }, "json");



});
</script>
