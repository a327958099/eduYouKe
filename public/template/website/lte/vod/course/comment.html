<!DOCTYPE html>
<html>

<head>
    <title>首页 {$site_info.site_name|default=''}</title>
    <meta name="keywords" content="{$site_info.site_seo_keywords|default=''}" />
    <meta name="description" content="{$site_info.site_seo_description|default=''}">
    {include file='../public/header' /}
    <link href="__TEMPSTATIC__/css/course.css" rel="stylesheet">
</head>

<body class="hold-transition layout-top-nav">
    <div class="wrapper">
        {include file='../public/nav' /}
        <div class="content-wrapper">
            <div class="course-info" style="background: url('{:getUrlPath($coursinfo.cource_image_url)}') center center;">
                <div class="course-detail">
                    <div class="container">
                        <nav aria-label="breadcrumb">
                            <ol class="breadcrumb mt-2">
                                {volist name="breadcrumb" id="vo" key="k"}
                                <li class="breadcrumb-item"><a href="{:url('/list',['list_id'=>$vo['id']])}">{$vo.title}</a></li>
                                {/volist}
                                <li class="breadcrumb-item active" aria-current="page"><a href="{:url('/course/index',['id'=>$coursinfo['id']])}">{$coursinfo.title}</a></li>
                            </ol>
                        </nav>
                        <div>
                            <h1 class="p-2 text-white">{$coursinfo.title}</h1>
                        </div>
                        <div class="mt-4">
                            <div class="text-white">
                                <p>
                                    <span class="p-2">难度:{$coursinfo.level_status}</span>
                                    <span class="p-2">时长:2小时</span>
                                    <span class="p-2">学习人数:530</span>
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="bg-white course-nav shadow-lg rounded">
                <div class="container">
                    <nav class="nav">
                        <a class="nav-link text-muted" href="{:url('/course/index',['id'=>$coursinfo['id']])}">课程介绍</a>
                        <a class="nav-link text-muted" href="{:url('/course/chapter',['id'=>$coursinfo['id']])}">课程章节</a>
                        <!-- <a class="nav-link text-muted" href="{:url('/course/articleList')}">关联文章</a> -->
                        <a class="nav-link active text-muted" href="{:url('/course/comment',['id'=>$coursinfo['id']])}">课程评论</a>
                    </nav>
                </div>
            </div>
            <div class="content">
                <div class="container">
                    <div class="row">
                        <div class="col-lg-9 col-md-12">
                            <div class="mt-3">
                                <div>
                                    {volist name="commentlist" id="vo"}
                                    <div class="mt-3 bg-white p-3 card">
                                        <div class="post">
                                            <div class="user-block">
                                                <img class="img-circle img-bordered-sm" src="
                                                {$vo.avatar_url ? getUrlPath($vo.avatar_url) :'__STATIC__/img/user4-128x128.jpg'}" alt="user image">
                                                <span class="username">
                                                    <a href="#">{$vo.nickname}</a>
                                                </span>
                                                <span class="description">{$vo.create_time}</span>
                                            </div>
                                            <!-- /.user-block -->
                                            <p>
                                                {$vo.content}
                                            </p>
                                            <p>
                                                <!-- <a href="#" class="link-black text-sm"><i class="fa fa-thumbs-up mr-1"></i> Like</a> -->
                                            </p>
                                        </div>
                                    </div>
                                    {/volist}
                                    <div class="mt-3 bg-white p-3 card">
                                        <div class="post">
                                            <div class="user-block">
                                                <img class="img-circle img-bordered-sm" src="{:getUserAvatarUrl() ? getUserAvatarUrl() :'__STATIC__/img/user4-128x128.jpg'}" alt="user image">
                                                <span class="username mt-2">
                                                    <a href="#">总有刁民想害朕</a>
                                                </span>
                                                <!-- <span class="description">输出你的看法吧~</span> -->
                                            </div>
                                            <!-- /.user-block -->
                                            <textarea class="form-control" id="introduce" name="introduce" rows="3"></textarea>
                                            <a href="javascript:;" class="float-right btn-primary btn-sm mt-2" id="addComment">
                                                发布
                                            </a>
                                        </div>
                                    </div>
                                </div>
                                <!-- 分页start -->
                                <div>
                                    {$page|raw}
                                </div>
                                <!-- 分页end -->
                            </div>
                        </div>
                        <div class="col-lg-3 col-md-12">
                            <div class="card mt-3">
                                <img src="{:getUrlPath($coursinfo.cource_image_url)}" class="card-img-top" alt="...">
                                <div class="p-2">
                                    <div class="card-body">
                                        <h5 class="card-title text-body">课程简介</h5>
                                        <p class="card-text text-black-50">{$coursinfo.description}</p>
                                    </div>
                                    <div class="card-body">
                                        {if $coursinfo.sell_price}
                                        <a href="{:url('/order/createOrder',['id'=>$coursinfo['id'],'type'=>'course'])}" class="btn btn-danger btn-sm btn-block">￥{$coursinfo.sell_price} 立即购买</a>
                                        {else /}
                                        <a href="{:url('/course/chapter',['id'=>$coursinfo['id']])}" class="btn btn-info btn-sm btn-block">立即学习</a>
                                        {/if}
                                    </div>
                                </div>
                                <div class="clearfix"></div>
                            </div>
                            <div class="card">
                                <div class="card-header">
                                    <h3 class="card-title">推荐课程</h3>
                                </div>
                                <div class="card-body p-0">
                                    <ul class="products-list product-list-in-card pl-2 pr-2">
                                        {volist name="recommend" id="vo"}
                                        <li class="item">
                                            <div class="product-img">
                                                <img src="{:getUrlPath($vo.cource_image_url)}" alt="Product Image" class="img-size-50">
                                            </div>
                                            <div class="product-info">
                                                <a href="{:url('/course/index',['id'=>$vo['course_id']])}" class="product-title">
                                                    {$vo.course_title}
                                                    <small class="product-description mt-1">
                                                        {$vo.description}
                                                    </small>
                                            </div>
                                        </li>
                                        {/volist}
                                    </ul>
                                </div>
                                <!-- /.card-body -->
                                <!-- <div class="card-footer text-center">
                                    <a href="javascript:void(0)" class="uppercase">查看全部课程</a>
                                </div> -->
                                <!-- /.card-footer -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <aside class="control-sidebar control-sidebar-dark">
        <!-- Control sidebar content goes here -->
        <div class="p-3">
            <h5>Title</h5>
            <p>Sidebar content</p>
        </div>
    </aside>
    {include file='../public/footer' /}
    </div>
    {include file='../public/script' /}
    <script type="text/javascript">
    $("#addComment").click(function() {


        //判断当前用户时候否登录
        var loginStatus = "{:getUserInfoData()}";
        if (loginStatus) {
            //发布评论
            var text = $("#introduce").val();
            var id = "{$coursinfo.id}";
            var url = window.location.href;
            if (text) {

                // console.log(text)

                $.post("/comment/addComment", { content: text, source_id: id, url: url }, function(data) {
                    console.log(data);
                    if (data.code == 1) {
                        //展示文案
                        success(data.message);
                        setTimeout(function() {
                            window.location.reload();
                        }, 1000);
                        //todo
                    } else {
                        error(data.message);
                    }
                });



            } else {
                error('评论内容不能为空...');
            }

        } else {
            //跳转登陆
            error('暂未登陆...');
            setTimeout(function() {
                window.location.href = "{:url('/login/login')}"
            }, 1000);
        }
    });
    </script>
</body>

</html>